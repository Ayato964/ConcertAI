/*
 * jsmidgen v0.1.5 (minified)
 *
 * This library provides a small API for constructing Standard MIDI Files
 * directly in the browser.  The code below is a direct copy of the
 * minified bundle hosted on jsDelivr (https://cdn.jsdelivr.net/npm/jsmidgen)
 * which is licensed under the MIT licence.  It defines a global `Midi`
 * object exposing File, Track and utility classes used when exporting
 * melodies in script.js.
 */
var Midi={};!function(t){var e=t.DEFAULT_VOLUME=90,n=(t.DEFAULT_DURATION=128,t.DEFAULT_CHANNEL=0,{midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(t){var e=/([a-g])(#+|b+)?([0-9]+)$/i.exec(t),i=e[1].toLowerCase(),r=e[2]||"";return 12*parseInt(e[3],10)+n.midi_letter_pitches[i]+("#"==r.substr(0,1)?1:-1)*r.length},ensureMidiPitch:function(t){return"number"!=typeof t&&/[^0-9]/.test(t)?n.midiPitchFromNote(t):parseInt(t,10)},midi_pitches_letter:{12:"c",13:"c#",14:"d",15:"d#",16:"e",17:"f",18:"f#",19:"g",20:"g#",21:"a",22:"a#",23:"b"},midi_flattened_notes:{"a#":"bb","c#":"db","d#":"eb","f#":"gb","g#":"ab"},noteFromMidiPitch:function(t,e){var i,r=0,s=t;return e=e||!1,t>23&&(s=t-12*(r=Math.floor(t/12)-1)),i=n.midi_pitches_letter[s],e&&i.indexOf("#")>0&&(i=n.midi_flattened_notes[i]),i+r},mpqnFromBpm:function(t){var e=Math.floor(6e7/t),n=[];do{n.unshift(255&e),e>>=8}while(e);for(;n.length<3;)n.push(0);return n},bpmFromMpqn:function(t){if(void 0!==t[0]){0;for(var e=0,n=t.length-1;n>=0;++e,--n)t[e]<<n}return Math.floor(6e7/t)},codes2Str:function(t){return String.fromCharCode.apply(null,t)},str2Bytes:function(t,e){if(e)for(;t.length/2<e;)t="0"+t;for(var n=[],i=t.length-1;i>=0;i-=2){var r=0===i?t[i]:t[i-1]+t[i];n.unshift(parseInt(r,16))}return n},translateTickTime:function(t){for(var e=127&t;t>>=7;)e<<=8,e|=127&t|128;for(var n=[];n.push(255&e),128&e;)e>>=8;return n}}),i=function(t){if(!this)return new i(t);!t||null===t.type&&void 0===t.type||null===t.channel&&void 0===t.channel||null===t.param1&&void 0===t.param1||(this.setTime(t.time),this.setType(t.type),this.setChannel(t.channel),this.setParam1(t.param1),this.setParam2(t.param2))};i.NOTE_OFF=128,i.NOTE_ON=144,i.AFTER_TOUCH=160,i.CONTROLLER=176,i.PROGRAM_CHANGE=192,i.CHANNEL_AFTERTOUCH=208,i.PITCH_BEND=224,i.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},i.prototype.setType=function(t){if(t<i.NOTE_OFF||t>i.PITCH_BEND)throw new Error("Trying to set an unknown event: "+t);this.type=t},i.prototype.setChannel=function(t){if(t<0||t>15)throw new Error("Channel is out of bounds.");this.channel=t},i.prototype.setParam1=function(t){this.param1=t},i.prototype.setParam2=function(t){this.param2=t},i.prototype.toBytes=function(){var t=[],e=this.type|15&this.channel;return t.push.apply(t,this.time),t.push(e),t.push(this.param1),void 0!==this.param2&&null!==this.param2&&t.push(this.param2),t};var r=function(t){if(!this)return new r(t);this.setTime(t.time),this.setType(t.type),this.setData(t.data)};r.SEQUENCE=0,r.TEXT=1,r.COPYRIGHT=2,r.TRACK_NAME=3,r.INSTRUMENT=4,r.LYRIC=5,r.MARKER=6,r.CUE_POINT=7,r.CHANNEL_PREFIX=32,r.END_OF_TRACK=47,r.TEMPO=81,r.SMPTE=84,r.TIME_SIG=88,r.KEY_SIG=89,r.SEQ_EVENT=127,r.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},r.prototype.setType=function(t){this.type=t},r.prototype.setData=function(t){this.data=t},r.prototype.toBytes=function(){if(!this.type)throw new Error("Type for meta-event not specified.");var t=[];if(t.push.apply(t,this.time),t.push(255,this.type),Array.isArray(this.data))t.push(this.data.length),t.push.apply(t,this.data);else if("number"==typeof this.data)t.push(1,this.data);else if(null!==this.data&&void 0!==this.data){t.push(this.data.length);var e=this.data.split("").map((function(t){return t.charCodeAt(0)}));t.push.apply(t,e)}else t.push(0);return t};var s=function(t){if(!this)return new s(t);var e=t||{};this.events=e.events||[]};s.START_BYTES=[77,84,114,107],s.END_BYTES=[0,255,47,0],s.prototype.addEvent=function(t){return this.events.push(t),this},s.prototype.addNoteOn=s.prototype.noteOn=function(t,r,s,o){return this.events.push(new i({type:i.NOTE_ON,channel:t,param1:n.ensureMidiPitch(r),param2:o||e,time:s||0})),this},s.prototype.addNoteOff=s.prototype.noteOff=function(t,r,s,o){return this.events.push(new i({type:i.NOTE_OFF,channel:t,param1:n.ensureMidiPitch(r),param2:o||e,time:s||0})),this},s.prototype.addNote=s.prototype.note=function(t,e,n,i,r){return this.noteOn(t,e,i,r),n&&this.noteOff(t,e,n,r),this},s.prototype.addChord=s.prototype.chord=function(t,e,n,i){if(!Array.isArray(e)&&!e.length)throw new Error("Chord must be an array of pitches");return e.forEach((function(e){this.noteOn(t,e,0,i)}),this),e.forEach((function(e,i){0===i?this.noteOff(t,e,n):this.noteOff(t,e)}),this),this},s.prototype.setInstrument=s.prototype.instrument=function(t,e,n){return this.events.push(new i({type:i.PROGRAM_CHANGE,channel:t,param1:e,time:n||0})),this},s.prototype.setTempo=s.prototype.tempo=function(t,e){return this.events.push(new r({type:r.TEMPO,data:n.mpqnFromBpm(t),time:e||0})),this},s.prototype.toBytes=function(){var t=0,e=[],i=s.START_BYTES,r=s.END_BYTES;this.events.forEach((function(n){var i=n.toBytes();t+=i.length,e.push.apply(e,i)})),t+=r.length;var o=n.str2Bytes(t.toString(16),4);return i.concat(o,e,r)};var o=function(t){if(!this)return new o(t);var e=t||{};if(e.ticks){if("number"!=typeof e.ticks)throw new Error("Ticks per beat must be a number!");if(e.ticks<=0||e.ticks>=32768||e.ticks%1!=0)throw new Error("Ticks per beat must be an integer between 1 and 32767!")}this.ticks=e.ticks||128,this.tracks=e.tracks||[]};o.HDR_CHUNKID="MThd",o.HDR_CHUNK_SIZE="\0\0\0\x06",o.HDR_TYPE0="\0\0",o.HDR_TYPE1="\0\x01",o.prototype.addTrack=function(t){return t?(this.tracks.push(t),this):(t=new s,this.tracks.push(t),t)},o.prototype.toBytes=function(){var t=this.tracks.length.toString(16),e=o.HDR_CHUNKID+o.HDR_CHUNK_SIZE;return parseInt(t,16)>1?e+=o.HDR_TYPE1:e+=o.HDR_TYPE0,e+=n.codes2Str(n.str2Bytes(t,2)),e+=String.fromCharCode(this.ticks/256,this.ticks%256),this.tracks.forEach((function(t){e+=n.codes2Str(t.toBytes())})),e},t.Util=n,t.File=o,t.Track=s,t.Event=i,t.MetaEvent=r}(Midi),"undefined"!=typeof module&&null!==module?module.exports=Midi:"undefined"!=typeof exports&&null!==exports?exports=Midi:this.Midi=Midi;